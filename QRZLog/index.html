<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RadioLog Pro v4 | Enterprise Edition</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --sidebar-bg: #212529;
            --accent-color: #0d6efd;
            --main-bg: #f8f9fa;
        }

        body {
            background-color: var(--main-bg);
            font-family: 'Inter', -apple-system, sans-serif;
            overflow: hidden;
        }

        /* Sidebar con estilo profesional */
        .sidebar {
            width: 280px;
            background-color: var(--sidebar-bg);
            height: 100vh;
            position: fixed;
            color: white;
            display: flex;
            flex-direction: column;
            transition: all 0.3s;
            z-index: 1000;
        }

        .logo-container {
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .logo-svg {
            width: 80px;
            height: 80px;
            fill: var(--accent-color);
            filter: drop-shadow(0 0 10px rgba(13, 110, 253, 0.5));
            margin-bottom: 15px;
        }

        .nav-link {
            color: rgba(255,255,255,0.7) !important;
            padding: 12px 25px;
            border-radius: 0;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 4px solid transparent;
        }

        .nav-link:hover, .nav-link.active {
            color: white !important;
            background: rgba(255,255,255,0.05);
            border-left-color: var(--accent-color);
        }

        /* Área de contenido */
        .content {
            margin-left: 280px;
            height: 100vh;
            overflow-y: auto;
            padding: 40px;
        }

        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.05);
        }

        .btn-icon {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .log-table-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
        }

        /* Badges de banda coloridos */
        .badge-band {
            background-color: #e9ecef;
            color: #495057;
            font-weight: 600;
        }

        /* Estilo para el Plan de Bandas */
        .tx-status { font-weight: bold; }
        .tx-allowed { color: #198754; }
        .tx-forbidden { color: #dc3545; }

        @media (max-width: 768px) {
            .sidebar { width: 80px; }
            .sidebar span, .sidebar h4 { display: none; }
            .content { margin-left: 80px; padding: 15px; }
            .logo-svg { width: 40px; height: 40px; }
        }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="logo-container">
        <svg class="logo-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zm4-6h-8v-2h8v2z"/>
            <path d="M12 7l-2 2h4l-2-2zM12 17l2-2h-4l2 2z"/>
        </svg>
        <h4 class="mb-0">RadioPro <small class="d-block text-muted fs-6">v4.0 Enterprise</small></h4>
    </div>
    
    <nav class="nav flex-column mt-3">
        <a class="nav-link active" href="#" onclick="showTab('logbook', this)">
            <i class="fas fa-book"></i> <span>Libro de Guardia</span>
        </a>
        <a class="nav-link" href="#" onclick="showTab('plan', this)">
            <i class="fas fa-broadcast-tower"></i> <span>Plan de Bandas</span>
        </a>
    </nav>

    <div class="mt-auto p-4 border-top border-secondary">
        <button class="btn btn-outline-light btn-sm w-100 mb-2 btn-icon" onclick="exportJSON()">
            <i class="fas fa-file-download"></i> <span>Exportar JSON</span>
        </button>
        <button class="btn btn-outline-info btn-sm w-100 btn-icon" onclick="document.getElementById('importInput').click()">
            <i class="fas fa-file-upload"></i> <span>Importar JSON</span>
        </button>
        <input type="file" id="importInput" hidden onchange="importJSON(event)">
    </div>
</div>

<div class="content">
    
    <div id="logbook-tab" class="tab-content">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="fw-bold">Gestión de Contactos</h2>
            <span class="text-muted"><i class="fas fa-map-marker-alt"></i> Basauri, Vizcaya</span>
        </div>

        <div class="card mb-4">
            <div class="card-body p-4">
                <form id="qsoForm" onsubmit="event.preventDefault(); handleSubmit();">
                    <input type="hidden" id="editId">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label class="form-label">Indicativo</label>
                            <input type="text" id="callsign" class="form-control form-control-lg" placeholder="EA4ABC" required>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">RST</label>
                            <input type="text" id="rst" class="form-control form-control-lg" value="59">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Banda</label>
                            <select id="band" class="form-select form-select-lg">
                                <option value="40m">40m</option>
                                <option value="20m">20m</option>
                                <option value="2m" selected>2m (VHF)</option>
                                <option value="70cm">70cm (UHF)</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">Modo</label>
                            <select id="mode" class="form-select form-select-lg">
                                <option value="FM">FM</option>
                                <option value="SSB">SSB</option>
                                <option value="CW">CW</option>
                                <option value="FT8">FT8</option>
                            </select>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button type="submit" id="saveBtn" class="btn btn-primary btn-lg w-100 btn-icon">
                                <i class="fas fa-plus-circle"></i> <span id="btnText">Registrar</span>
                            </button>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Comentarios</label>
                            <input type="text" id="comment" class="form-control" placeholder="Nombre, ubicación, condiciones...">
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="log-table-container">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Fecha (UTC)</th>
                        <th>Indicativo</th>
                        <th>Banda</th>
                        <th>Modo</th>
                        <th>RST</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="logList">
                    </tbody>
            </table>
        </div>
    </div>

    <div id="plan-tab" class="tab-content d-none">
        <h2 class="fw-bold mb-4">Plan de Bandas e Información Técnica</h2>
        <div class="card">
            <div class="card-body p-0">
                <table class="table table-striped mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th>Frecuencia (MHz)</th>
                            <th>Uso / Banda</th>
                            <th>TX</th>
                            <th>Modo</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>65.0 - 108.0</td><td>FM Comercial</td><td class="tx-status tx-forbidden">NO</td><td>WFM</td></tr>
                        <tr><td>108.0 - 136.0</td><td>Banda Aérea</td><td class="tx-status tx-forbidden">NO</td><td>AM</td></tr>
                        <tr><td>144.0 - 146.0</td><td>Radioaficionados (2m)</td><td class="tx-status tx-allowed">SÍ</td><td>FM/SSB/CW</td></tr>
                        <tr><td>136.0 - 174.0</td><td>VHF Extendida</td><td class="tx-status tx-forbidden">RX (VFO)</td><td>FM</td></tr>
                        <tr><td>200.0 - 260.0</td><td>Banda 220</td><td class="tx-status tx-allowed">SÍ (H8)</td><td>FM</td></tr>
                        <tr><td>430.0 - 440.0</td><td>Radioaficionados (70cm)</td><td class="tx-status tx-allowed">SÍ</td><td>FM/SSB/CW</td></tr>
                        <tr><td>446.0 - 446.2</td><td>PMR446 (Uso libre)</td><td class="tx-status tx-forbidden">RX*</td><td>NFM</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="card-footer text-muted">
                * Nota: El Tidradio H8 permite TX en rangos no permitidos si está abierto de bandas. Usa con responsabilidad técnica.
            </div>
        </div>
    </div>

</div>

<script>
    let logs = JSON.parse(localStorage.getItem('hamLogs')) || [];
    let isEditing = false;

    // Cambiar pestañas
    function showTab(tabId, el) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.add('d-none'));
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        document.getElementById(tabId + '-tab').classList.remove('d-none');
        el.classList.add('active');
    }

    // Guardar o Actualizar
    function handleSubmit() {
        const id = document.getElementById('editId').value;
        const data = {
            id: id ? parseInt(id) : Date.now(),
            timestamp: new Date().toISOString().replace('T', ' ').substring(0, 16),
            callsign: document.getElementById('callsign').value.toUpperCase(),
            rst: document.getElementById('rst').value,
            band: document.getElementById('band').value,
            mode: document.getElementById('mode').value,
            comment: document.getElementById('comment').value
        };

        if(isEditing) {
            logs = logs.map(l => l.id === data.id ? data : l);
            cancelEdit();
        } else {
            logs.unshift(data);
        }

        localStorage.setItem('hamLogs', JSON.stringify(logs));
        renderLogs();
        document.getElementById('qsoForm').reset();
    }

    // Renderizar la tabla
    function renderLogs() {
        const container = document.getElementById('logList');
        container.innerHTML = logs.map(log => `
            <tr>
                <td class="text-muted small">${log.timestamp}</td>
                <td><span class="fw-bold text-primary">${log.callsign}</span></td>
                <td><span class="badge badge-band">${log.band}</span></td>
                <td><span class="badge bg-light text-dark">${log.mode}</span></td>
                <td>${log.rst}</td>
                <td>
                    <button class="btn btn-sm btn-outline-primary" onclick="editEntry(${log.id})"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteEntry(${log.id})"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
        `).join('');
    }

    function editEntry(id) {
        const log = logs.find(l => l.id === id);
        document.getElementById('editId').value = log.id;
        document.getElementById('callsign').value = log.callsign;
        document.getElementById('rst').value = log.rst;
        document.getElementById('band').value = log.band;
        document.getElementById('mode').value = log.mode;
        document.getElementById('comment').value = log.comment;

        isEditing = true;
        document.getElementById('btnText').innerText = "Actualizar";
        document.getElementById('saveBtn').classList.replace('btn-primary', 'btn-warning');
        window.scrollTo(0,0);
    }

    function cancelEdit() {
        isEditing = false;
        document.getElementById('editId').value = '';
        document.getElementById('btnText').innerText = "Registrar";
        document.getElementById('saveBtn').classList.replace('btn-warning', 'btn-primary');
    }

    function deleteEntry(id) {
        if(confirm("¿Seguro que quieres borrar este QSO?")) {
            logs = logs.filter(l => l.id !== id);
            localStorage.setItem('hamLogs', JSON.stringify(logs));
            renderLogs();
        }
    }

    // Gestión de Archivos
    function exportJSON() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(logs, null, 2));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "radiolog_backup.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }

    function importJSON(event) {
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                logs = JSON.parse(e.target.result);
                localStorage.setItem('hamLogs', JSON.stringify(logs));
                renderLogs();
                alert("Base de datos importada con éxito.");
            } catch (err) {
                alert("Error al procesar el archivo JSON.");
            }
        };
        reader.readAsText(event.target.files[0]);
    }

    // Inicio
    renderLogs();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
